<script src="https://www.gstatic.com/firebasejs/8.5.0/firebase-app.js"></script>

<script src="https://www.gstatic.com/firebasejs/8.5.0/firebase-analytics.js"></script>

<script src="https://www.gstatic.com/firebasejs/8.5.0/firebase-database.js"></script>

<script>

    var firebaseConfig = {
        apiKey: "AIzaSyAId5U8P5nDEhytscOGupt7yymM9R0Gdsc",
        authDomain: "wildlife-monitoring-system.firebaseapp.com",
        databaseURL: "https://wildlife-monitoring-system-default-rtdb.asia-southeast1.firebasedatabase.app",
        projectId: "wildlife-monitoring-system",
        storageBucket: "wildlife-monitoring-system.appspot.com",
        messagingSenderId: "345584392239",
        appId: "1:345584392239:web:1588fc68d350da6ecc4eda",
        measurementId: "G-1MER911JKD"
    };
    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    firebase.analytics();
</script>

<div class="layout-px-spacing">

    <div class="row layout-top-spacing">
        <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 col-12 layout-spacing">
            <div class="row">
                <div class="col-lg-12 col-12 layout-spacing">
                    <div class="statbox widget box box-shadow">
                        <div class="widget-header">
                            <div class="row">
                                <div class="col-xl-12 col-md-12 col-sm-12 col-12">
                                    <h4>Real Time Update</h4>
                                </div>
                            </div>
                        </div>
                        <div class="row" >
                            <div class="col-xl-12 col-md-12 col-sm-12 col-12">
                                <div id="realTimeMap" style="height: 1000px; padding: 5px 10px 10px;"></div>
                            </div>
<!--                            <div class="col-md-3">-->

<!--                            </div>-->
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>
</div>


<script>
    let realTimeMap;
    let infoWindow = null;

    let markers = []

    function initMap() {
        realTimeMap = new google.maps.Map(document.getElementById("realTimeMap"), {
            zoom: 8,
            center: {
                lat: 6.9271,
                lng: 79.8612
            },
        });

    }

    function openWindow(map, marker, title, data, type){

        let contentString = null;

        if(type === 'RG'){
            contentString =
                '<div class="layout-px-spacing1">' +
                '<div class="row layout-top-spacing">' +
                '<div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 col-12 layout-spacing">' +
                '<div class="row">' +
                    '<h4>'+title+'</h4>' +
                '<div class="col-lg-12 col-12 layout-spacing">' +
                '<div class="statbox widget box box-shadow">' +
                '<div class="widget-header">' +
                '<div class="row">' +
                '<div class="col-xl-12 col-md-12 col-sm-12 col-12">' +

                '</div>' +
                '</div>' +
                '</div>' +
                '<div class="row">' +
                '<div class="col-md-12" style="margin-left: 10px;">' +
                    '<table>' +
                        '<tr>' +
                            '<th>Date: </th>' +
                            '<td>'+data.date+'</td>' +
                        '</tr>' +
                        '<tr>' +
                            '<th>Latitude: </th>' +
                            '<td>'+data.lat+'</td>' +
                        '</tr>' +
                        '<tr>' +
                            '<th>Longitude: </th>' +
                            '<td>'+data.long+'</td>' +
                        '</tr>' +
                        '<tr>' +
                            '<th>Minute Count: </th>' +
                            '<td>'+data.minutecount+'</td>' +
                        '</tr>' +
                        '<tr>' +
                            '<th>Soil Dry: </th>' +
                            '<td>'+data.soildry+'</td>' +
                        '</tr>' +
                        '<tr>' +
                            '<th>Weather Dry: </th>' +
                            '<td>'+data.weatherdry+'</td>' +
                        '</tr>' +
                '   </table>' +
                '</div>' +
                '</div>' +
                '</div>' +
                '</div>' +
                '</div>' +
                '</div>' +
                '</div>' +
                '</div>'
        }

        if(type === 'SG'){
            contentString =
                '<div class="layout-px-spacing1">' +
                '<div class="row layout-top-spacing">' +
                '<div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 col-12 layout-spacing">' +
                '<div class="row">' +
                '<h4>'+title+'</h4>' +
                '<div class="col-lg-12 col-12 layout-spacing">' +
                '<div class="statbox widget box box-shadow">' +
                '<div class="widget-header">' +
                '<div class="row">' +
                '<div class="col-xl-12 col-md-12 col-sm-12 col-12">' +
                '</div>' +
                '</div>' +
                '</div>' +
                '<div class="row">' +
                '<div class="col-md-12" style="margin-left: 10px;">' +
                '<table>' +
                '<tr>' +
                '<th>Date: </th>' +
                '<td>'+data.date+'</td>' +
                '</tr>' +
                '<tr>' +
                '<th>Latitude: </th>' +
                '<td>'+data.lat+'</td>' +
                '</tr>' +
                '<tr>' +
                '<th>Longitude: </th>' +
                '<td>'+data.long+'</td>' +
                '</tr>' +
                '<tr>' +
                '<th>Status: </th>' +
                '<td>'+data.status+'</td>' +
                '</tr>' +
                '   </table>' +
                '</div>' +
                '</div>' +
                '</div>' +
                '</div>' +
                '</div>' +
                '</div>' +
                '</div>' +
                '</div>'
        }

        if(type === 'TK'){
            contentString =
                '<div class="layout-px-spacing1">' +
                '<div class="row layout-top-spacing">' +
                '<div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 col-12 layout-spacing">' +
                '<div class="row">' +
                '<h4>'+title+'</h4>' +
                '<div class="col-lg-12 col-12 layout-spacing">' +
                '<div class="statbox widget box box-shadow">' +
                '<div class="widget-header">' +
                '<div class="row">' +
                '<div class="col-xl-12 col-md-12 col-sm-12 col-12">' +
                '</div>' +
                '</div>' +
                '</div>' +
                '<div class="row">' +
                '<div class="col-md-12" style="margin-left: 10px;">' +
                '<table>' +
                '<tr>' +
                '<th>Date: </th>' +
                '<td>'+data.date+'</td>' +
                '</tr>' +
                '<tr>' +
                '<th>Latitude: </th>' +
                '<td>'+data.lat+'</td>' +
                '</tr>' +
                '<tr>' +
                '<th>Longitude: </th>' +
                '<td>'+data.long+'</td>' +
                '</tr>' +
                '<tr>' +
                '<th>Consumption: </th>' +
                '<td>'+data.consumption+'</td>' +
                '</tr>' +
                '</table>' +
                '</div>' +
                '</div>' +
                '</div>' +
                '</div>' +
                '</div>' +
                '</div>' +
                '</div>' +
                '</div>'
        }

        if(type === 'WB'){
            contentString =
                '<div class="layout-px-spacing1">' +
                '<div class="row layout-top-spacing">' +
                '<div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 col-12 layout-spacing">' +
                '<div class="row">' +
                '<h4>'+title+'</h4>' +
                '<div class="col-lg-12 col-12 layout-spacing">' +
                '<div class="statbox widget box box-shadow">' +
                '<div class="widget-header">' +
                '<div class="row">' +
                '<div class="col-xl-12 col-md-12 col-sm-12 col-12">' +

                '</div>' +
                '</div>' +
                '</div>' +
                '<div class="row">' +
                '<div class="col-md-12" style="margin-left: 10px;">' +
                '<table>' +
                '<tr>' +
                '<th>Date: </th>' +
                '<td>'+data.date+'</td>' +
                '</tr>' +
                '<tr>' +
                '<th>Latitude: </th>' +
                '<td>'+data.lat+'</td>' +
                '</tr>' +
                '<tr>' +
                '<th>Longitude: </th>' +
                '<td>'+data.long+'</td>' +
                '</tr>' +
                '<th>Altitude: </th>' +
                '<td>'+data.altitude+'</td>' +
                '</tr>' +
                '<tr>' +
                '<th>PH Value: </th>' +
                '<td>'+data.ph+'</td>' +
                '</tr>' +
                '<tr>' +
                '<th>Water Temperature: </th>' +
                '<td>'+data.temperature+'</td>' +
                '</tr>' +
                '</table>' +
                '</div>' +
                '</div>' +
                '</div>' +
                '</div>' +
                '</div>' +
                '</div>' +
                '</div>' +
                '</div>'
        }



        infoWindow = new google.maps.InfoWindow({
            content: contentString,
        });

        infoWindow.open(map, marker);
    }

    function addMarker(id, location, map, title, data, type, url) {
        let marker = new google.maps.Marker({
            id: id,
            position: location,
            map: map,
            title: title,
            icon: url,

        });
        marker.addListener("click", () => {
            openWindow(map, marker, title, data, type);
        });

        markers[id] = marker;
    }


    function deleteMarker(id) {
        let marker = markers[id];
        if(marker !== undefined)
            marker.setMap(null);
    }

</script>
<script type="text/javascript" src="https://maps.google.com/maps/api/js?key=AIzaSyB8BbO_t_LXJLuBuHLnRMvXBJH8_S7q2IM&callback=initMap" async></script>


<script>
    function doReal(){
        firebase.database().ref().child('RG').child('RG1').limitToLast(1).on("value", function(snapshot) {
            if (snapshot.exists()) {
                snapshot.forEach((child) => {
                    deleteMarker(0);
                    let coordinateRG1 = {lat: parseFloat(child.val().lat), lng: parseFloat(child.val().long)};
                    addMarker(0, coordinateRG1, realTimeMap, 'RG1', child.val(), 'RG', 'http://maps.google.com/mapfiles/ms/micons/green.png');
                });
            }
            else{
                console.log("There's no proper data");
                // alert("There's no proper data.");
            }
        });

        firebase.database().ref().child('RG').child('RG2').limitToLast(1).on("value", function(snapshot) {
            if (snapshot.exists()) {
                snapshot.forEach((child) => {
                    deleteMarker(1);
                    let coordinateRG1 = {lat: parseFloat(child.val().lat), lng: parseFloat(child.val().long)};
                    addMarker(1, coordinateRG1, realTimeMap, 'RG2', child.val(), 'RG', 'http://maps.google.com/mapfiles/ms/micons/green.png');
                });
            }
            else{
                console.log("There's no proper data");
                // alert("There's no proper data.");
            }
        });

        firebase.database().ref().child('SG').child('SG1').on("value", function(snapshot) {
            if (snapshot.exists()) {
                deleteMarker(2);
                let coordinateRG1 = {lat: parseFloat(snapshot.val().lat), lng: parseFloat(snapshot.val().long)};
                addMarker(2, coordinateRG1, realTimeMap, 'SG1', snapshot.val(), 'SG', 'http://maps.google.com/mapfiles/ms/micons/orange.png');

                // snapshot.forEach((child) => {
                //     console.log(child.val());
                //     deleteMarker(2);
                //     let coordinateRG1 = {lat: parseFloat(child.val().lat), lng: parseFloat(child.val().long)};
                //     addMarker(2, coordinateRG1, realTimeMap, 'SG1', child.val(), 'SG');
                // });
            }
            else{
                console.log("There's no proper data");
                // alert("There's no proper data.");
            }
        });

        firebase.database().ref().child('SG').child('SG2').on("value", function(snapshot) {
            if (snapshot.exists()) {
                deleteMarker(3);
                let coordinateRG1 = {lat: parseFloat(snapshot.val().lat), lng: parseFloat(snapshot.val().long)};
                addMarker(3, coordinateRG1, realTimeMap, 'SG2', snapshot.val(), 'SG', 'http://maps.google.com/mapfiles/ms/micons/orange.png');
                // snapshot.forEach((child) => {
                //     deleteMarker(3);
                //     let coordinateRG1 = {lat: parseFloat(child.val().lat), lng: parseFloat(child.val().long)};
                //     addMarker(3, coordinateRG1, realTimeMap, 'SG2', child.val(), 'SG');
                // });
            }
            else{
                console.log("There's no proper data");
                // alert("There's no proper data.");
            }
        });

        firebase.database().ref().child('TK').child('TKA1').limitToLast(1).on("value", function(snapshot) {
            if (snapshot.exists()) {
                snapshot.forEach((child) => {
                    deleteMarker(4);
                    let coordinateRG1 = {lat: parseFloat(child.val().lat), lng: parseFloat(child.val().long)};
                    addMarker(4, coordinateRG1, realTimeMap, 'TKA1', child.val(), 'TK', 'http://maps.google.com/mapfiles/ms/micons/pink.png');
                });
            }
            else{
                console.log("There's no proper data");
                // alert("There's no proper data.");
            }
        });

        firebase.database().ref().child('TK').child('TKM1').limitToLast(1).on("value", function(snapshot) {
            if (snapshot.exists()) {
                snapshot.forEach((child) => {
                    deleteMarker(5);
                    let coordinateRG1 = {lat: parseFloat(child.val().lat), lng: parseFloat(child.val().long)};
                    addMarker(5, coordinateRG1, realTimeMap, 'TKM1', child.val(), 'TK', 'http://maps.google.com/mapfiles/ms/micons/pink.png');
                });
            }
            else{
                console.log("There's no proper data");
                // alert("There's no proper data.");
            }
        });

        firebase.database().ref().child('TK').child('TKT1').limitToLast(1).on("value", function(snapshot) {
            if (snapshot.exists()) {
                snapshot.forEach((child) => {
                    deleteMarker(6);
                    let coordinateRG1 = {lat: parseFloat(child.val().lat), lng: parseFloat(child.val().long)};
                    addMarker(6, coordinateRG1, realTimeMap, 'TKT1', child.val(), 'TK', 'http://maps.google.com/mapfiles/ms/micons/pink.png');
                });
            }
            else{
                console.log("There's no proper data");
                // alert("There's no proper data.");
            }
        });

        firebase.database().ref().child('TK').child('TKT2').limitToLast(1).on("value", function(snapshot) {
            if (snapshot.exists()) {
                snapshot.forEach((child) => {
                    deleteMarker(7);
                    let coordinateRG1 = {lat: parseFloat(child.val().lat), lng: parseFloat(child.val().long)};
                    addMarker(7, coordinateRG1, realTimeMap, 'TKT2', child.val(), 'TK', 'http://maps.google.com/mapfiles/ms/micons/pink.png');
                });
            }
            else{
                console.log("There's no proper data");
                // alert("There's no proper data.");
            }
        });

        firebase.database().ref().child('WB').child('WB1').limitToLast(1).on("value", function(snapshot) {
            if (snapshot.exists()) {
                snapshot.forEach((child) => {
                    deleteMarker(8);
                    let coordinateRG1 = {lat: parseFloat(child.val().lat), lng: parseFloat(child.val().long)};
                    addMarker(8, coordinateRG1, realTimeMap, 'WB1', child.val(), 'WB', 'http://maps.google.com/mapfiles/ms/micons/blue.png');
                });
            }
            else{
                console.log("There's no proper data");
                // alert("There's no proper data.");
            }
        });

        firebase.database().ref().child('WB').child('WB2').limitToLast(1).on("value", function(snapshot) {
            if (snapshot.exists()) {
                snapshot.forEach((child) => {
                    deleteMarker(9);
                    let coordinateRG1 = {lat: parseFloat(child.val().lat), lng: parseFloat(child.val().long)};
                    addMarker(9, coordinateRG1, realTimeMap, 'WB2', child.val(), 'WB', 'http://maps.google.com/mapfiles/ms/micons/blue.png');
                });
            }
            else{
                console.log("There's no proper data");
                // alert("There's no proper data.");
            }
        });
    }

    function alert(message){
        swal({
            type: 'error',
            title: 'Oops...',
            text: message,
            footer: '',
            padding: '2em'
        })
    }

    $( document ).ready(function() {
        doReal();
    });

</script>